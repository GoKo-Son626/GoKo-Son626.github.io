<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>xv6-riscv_ch4 - GoKo&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="GoKo&#039;s blog"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="GoKo&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="How traps and system calls work on RISC-V. It introduces the trap mechanism, how user programs invoke system calls, how the kernel handles those traps, and how arguments are passed. It also covers ke"><meta property="og:type" content="blog"><meta property="og:title" content="GoKo"><meta property="og:url" content="https://goko-son626.github.io/"><meta property="og:site_name" content="GoKo"><meta property="og:description" content="How traps and system calls work on RISC-V. It introduces the trap mechanism, how user programs invoke system calls, how the kernel handles those traps, and how arguments are passed. It also covers ke"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><meta property="article:published_time" content="2025-02-12T13:59:10.000Z"><meta property="article:modified_time" content="2025-05-16T06:19:53.068Z"><meta property="article:author" content="GoKo Mell"><meta property="article:tag" content="xv6-riscv"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://goko-son626.github.io/post/xv6-riscv-ch4.html"},"headline":"GoKo's blog","image":["https://goko-son626.github.io/img/og_image.png"],"datePublished":"2025-02-12T13:59:10.000Z","dateModified":"2025-05-16T06:19:53.068Z","author":{"@type":"Person","name":"GoKo Mell"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"How traps and system calls work on RISC-V. It introduces the trap mechanism, how user programs invoke system calls, how the kernel handles those traps, and how arguments are passed. It also covers ke"}</script><link rel="canonical" href="https://goko-son626.github.io/post/xv6-riscv-ch4.html"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss.xml" title="GoKo's blog" type="application/rss+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/GoKo-Mell.png" alt="GoKo&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/friend">Friend</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-02-12  <a class="commentCountImg" href="/post/xv6-riscv-ch4.html#comment-container"><span class="display-none-class">c9eb2fed64c7d1c21a0535ad12c23262</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="c9eb2fed64c7d1c21a0535ad12c23262">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>20 分钟  <i class="fas fa-pencil-alt"> </i>3.0 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">xv6-riscv_ch4</h1><div class="content"><ul>
<li><em><strong>How traps and system calls work on RISC-V. It introduces the trap mechanism, how user programs invoke system calls, how the kernel handles those traps, and how arguments are passed. It also covers kernel-mode traps, page faults, and real-world implications like protection and isolation.</strong></em></li>
</ul>
<span id="more"></span>

<h2 id="ch4-Traps-and-system-calls"><a href="#ch4-Traps-and-system-calls" class="headerlink" title="ch4: Traps and system calls"></a><strong>ch4: Traps and system calls</strong></h2><ul>
<li><p>There are three kinds of event which cause the CPU to set aside ordinary execution of instructions and force a transfer of control to special code that handles the event. and we uses <code>trap</code> as a generic term for these situations.</p>
<ul>
<li>One situation is a <code>systemcall</code>, when a user program executes the ecall instruction to ask the kernel to do something for it. </li>
<li>Another situation is an <code>exception</code>: an instruction (user or kernel) does something illegal, such as divide by zero or use an invalid virtual address. </li>
<li>The third situation is a <code>device interrupt</code>, when a device signals that it needs attention, for example when the disk hardware finishes a read or write request.</li>
</ul>
</li>
<li><p>Xv6 handles all traps in the kernel; traps are not delivered to user code. Handling traps in the kernel is natural for system calls. It makes sense for interrupts since isolation demands that only the kernel be allowed to use devices, and because the kernel is a convenient mechanism with which to share devices among multiple processes. It also makes sense for exceptions since xv6 responds to all exceptions from user space by killing the offending program.</p>
</li>
<li><p>Xv6 trap handling proceeds in four stages: </p>
<ul>
<li>hardware actions taken by the RISC-V CPU,</li>
<li>some assembly instructions that prepare the way for kernel C code</li>
<li>a C function that decides what to do with the trap</li>
<li>and the system call or device-driver service routine.</li>
</ul>
<p>While commonality among the three trap types suggests that a kernel could handle all traps with a single code path, it turns out to be convenient to have separate code for two distinct cases: traps from user space, and traps from kernel space. Kernel code (assembler or C) that processes a trap is often called a handler; the first handler instructions are usually written in assembler (rather than C) and are sometimes called a vector.</p>
</li>
</ul>
<h3 id="4-1-RISC-V-trap-machinery机制"><a href="#4-1-RISC-V-trap-machinery机制" class="headerlink" title="4.1 RISC-V trap machinery机制"></a>4.1 RISC-V trap machinery机制</h3><ul>
<li><p>Each RISC-V CPU has a set of control registers that the kernel writes to tell the CPU how to handle traps, and that the kernel can read to find out about a trap that has occurred. The RISC-V documents contain the full story [3]. riscv.h (kernel&#x2F;riscv.h:1) contains definitions that xv6 uses. Here’s an outline of the most important registers:</p>
<ul>
<li><code>stvec</code>: The kernel writes the address of its trap handler here; the RISC-V jumps to the address in stvec to handle a trap.</li>
<li><code>sepc</code>: When a trap occurs, RISC-V saves the program counter here (since the pc is then overwritten with the value in stvec). The sret (return from trap) instruction copies sepc to the pc. The kernel can write sepc to control where sret goes.</li>
<li><code>scause</code>: RISC-V puts a number here that describes the reason for the trap.</li>
<li><code>sscratch</code>: The trap handler code uses sscratch to help it avoid overwriting user registers before saving them.</li>
<li><code>sstatus</code>: The SIE bit in sstatus controls whether device interrupts are enabled. If the kernel clears SIE, the RISC-V will defer device interrupts until the kernel sets SIE. The SPP bit indicates whether a trap came from user mode or supervisor mode, and controls to what mode sret returns.</li>
</ul>
<p>The above registers relate to traps handled in supervisor mode, and they cannot be read or written in user mode. Each CPU on a multi-core chip has its own set of these registers, and more than one CPU may be handling a trap at any given time.</p>
</li>
<li><p>When it needs to force a trap, the RISC-V hardware does the following for all trap types:</p>
<ol>
<li>If the trap is a device interrupt, and the sstatus SIE bit is clear, don’t do any of the following.</li>
<li>Disable interrupts by clearing the SIE bit in sstatus.</li>
<li>Copy the pc to sepc.</li>
<li>Save the current mode (user or supervisor) in the SPP bit in sstatus.</li>
<li>Set scause to reflect the trap’s cause.</li>
<li>Set the mode to supervisor.</li>
<li>Copy stvec to the pc.</li>
<li>Start executing at the new pc.</li>
</ol>
<p>Note that the CPU doesn’t switch to the kernel page table, doesn’t switch to a stack in the kernel, and doesn’t save any registers other than the pc. Kernel software must perform these tasks. One reason that the CPU does minimal work during a traps is to provide flexibility to software; for example, some operating systems omit a page table switch in some situations to increase trap performance.<br>It’s worth thinking about whether any of the steps listed above could be omitted, perhaps in search of faster traps. Though there are situations in which a simpler sequence can work, many of the steps would be dangerous to omit in general. For example, suppose that the CPU didn’t switch program counters. Then a trap from user space could switch to supervisor mode while still running user instructions. Those user instructions could break user&#x2F;kernel isolation, for example by modifying the satp register to point to a page table that allowed accessing all of physical memory. It is thus important that the CPU switch to a kernel-specified instruction address, namely <code>stvec</code>.</p>
</li>
</ul>
<h3 id="4-2-Traps-from-user-space"><a href="#4-2-Traps-from-user-space" class="headerlink" title="4.2 Traps from user space"></a>4.2 Traps from user space</h3><p>Xv6 handles traps differently depending on whether the trap occurs while executing in the kernel<br>or in user code. Here is the story for traps from user code; Section 4.5 describes traps from kernel<br>code.<br>A trap may occur while executing in user space if the user program makes a system call (ecall<br>instruction), or does something illegal, or if a device interrupts. The high-level path of a trap from<br>user space is uservec (kernel&#x2F;trampoline.S:22), then usertrap (kernel&#x2F;trap.c:37); and when re-<br>turning, usertrapret (kernel&#x2F;trap.c:90) and then userret (kernel&#x2F;trampoline.S:101).<br>A major constraint on the design of xv6’s trap handling is the fact that the RISC-V hardware<br>does not switch page tables when it forces a trap. This means that the trap handler address in<br>stvec must have a valid mapping in the user page table, since that’s the page table in force when<br>the trap handling code starts executing. Furthermore, xv6’s trap handling code needs to switch to<br>the kernel page table; in order to be able to continue executing after that switch, the kernel page<br>table must also have a mapping for the handler pointed to by stvec.<br>Xv6 satisfies these requirements using a trampoline page. The trampoline page contains uservec,<br>the xv6 trap handling code that stvec points to. The trampoline page is mapped in every process’s<br>page table at address TRAMPOLINE, which is at the top of the virtual address space so that it will be<br>above memory that programs use for themselves. The trampoline page is also mapped at address<br>TRAMPOLINE in the kernel page table. See Figure 2.3 and Figure 3.3. Because the trampoline<br>page is mapped in the user page table, traps can start executing there in supervisor mode. Because<br>the trampoline page is mapped at the same address in the kernel address space, the trap handler<br>can continue to execute after it switches to the kernel page table.<br>The code for the uservec trap handler is in trampoline.S (kernel&#x2F;trampoline.S:22). When<br>uservec starts, all 32 registers contain values owned by the interrupted user code. These 32<br>values need to be saved somewhere in memory, so that later on the kernel can restore them before<br>returning to user space. Storing to memory requires use of a register to hold the address, but at this<br>point there are no general-purpose registers available! Luckily RISC-V provides a helping hand in<br>the form of the sscratch register. The csrw instruction at the start of uservec saves a0 in<br>sscratch. Now uservec has one register (a0) to play with.<br>uservec’s next task is to save the 32 user registers. The kernel allocates, for each process, a<br>page of memory for a trapframe structure that (among other things) has space to save the 32<br>user registers (kernel&#x2F;proc.h:43). Because satp still refers to the user page table, uservec needs<br>the trapframe to be mapped in the user address space. Xv6 maps each process’s trapframe at virtual<br>address TRAPFRAME in that process’s user page table; TRAPFRAME is just below TRAMPOLINE.<br>The process’s p-&gt;trapframe also points to the trapframe, though at its physical address so the<br>kernel can use it through the kernel page table.<br>Thus uservec loads address TRAPFRAME into a0 and saves all the user registers there,<br>including the user’s a0, read back from sscratch.<br>The trapframe contains the address of the current process’s kernel stack, the current CPU’s<br>hartid, the address of the usertrap function, and the address of the kernel page table. uservec<br>retrieves these values, switches satp to the kernel page table, and jumps to usertrap.<br>The job of usertrap is to determine the cause of the trap, process it, and return (kernel&#x2F;-<br>trap.c:37). It first changes stvec so that a trap while in the kernel will be handled by kernelvec<br>rather than uservec. It saves the sepc register (the saved user program counter), because<br>usertrap might call yield to switch to another process’s kernel thread, and that process might<br>return to user space, in the process of which it will modify sepc. If the trap is a system call,<br>usertrap calls syscall to handle it; if a device interrupt, devintr; otherwise it’s an ex-<br>ception, and the kernel kills the faulting process. The system call path adds four to the saved user<br>program counter because RISC-V, in the case of a system call, leaves the program pointer pointing<br>to the ecall instruction but user code needs to resume executing at the subsequent instruction.<br>On the way out, usertrap checks if the process has been killed or should yield the CPU (if this<br>trap is a timer interrupt).<br>The first step in returning to user space is the call to usertrapret (kernel&#x2F;trap.c:90). This<br>function sets up the RISC-V control registers to prepare for a future trap from user space: setting<br>stvec to uservec and preparing the trapframe fields that uservec relies on. usertrapret<br>sets sepc to the previously saved user program counter. At the end, usertrapret calls userret<br>on the trampoline page that is mapped in both user and kernel page tables; the reason is that as-<br>sembly code in userret will switch page tables.<br>usertrapret’s call to userret passes a pointer to the process’s user page table in a0<br>(kernel&#x2F;trampoline.S:101). userret switches satp to the process’s user page table. Recall that the<br>user page table maps both the trampoline page and TRAPFRAME, but nothing else from the kernel.<br>The trampoline page mapping at the same virtual address in user and kernel page tables allows<br>userret to keep executing after changing satp. From this point on, the only data userret<br>can use is the register contents and the content of the trapframe. userret loads the TRAPFRAME<br>address into a0, restores saved user registers from the trapframe via a0, restores the saved user<br>a0, and executes sret to return to user space.</p>
<h3 id="4-3-Code-Calling-system-calls"><a href="#4-3-Code-Calling-system-calls" class="headerlink" title="4.3 Code: Calling system calls"></a>4.3 Code: Calling system calls</h3><p>Chapter 2 ended with initcode.S invoking the exec system call (user&#x2F;initcode.S:11). Let’s look<br>at how the user call makes its way to the exec system call’s implementation in the kernel.<br>initcode.S places the arguments for exec in registers a0 and a1, and puts the system call<br>number in a7. System call numbers match the entries in the syscalls array, a table of function<br>pointers (kernel&#x2F;syscall.c:107). The ecall instruction traps into the kernel and causes uservec,<br>usertrap, and then syscall to execute, as we saw above.<br>syscall (kernel&#x2F;syscall.c:132) retrieves the system call number from the saved a7 in the trapframe<br>and uses it to index into syscalls. For the first system call, a7 contains SYS_exec (ker-<br>nel&#x2F;syscall.h:8), resulting in a call to the system call implementation function sys_exec.<br>When sys_exec returns, syscall records its return value in p-&gt;trapframe-&gt;a0. This will<br>cause the original user-space call to exec() to return that value, since the C calling convention<br>on RISC-V places return values in a0. System calls conventionally return negative numbers to<br>indicate errors, and zero or positive numbers for success. If the system call number is invalid,<br>syscall prints an error and returns −1.</p>
<h3 id="4-4-Code-System-call-arguments"><a href="#4-4-Code-System-call-arguments" class="headerlink" title="4.4 Code: System call arguments"></a>4.4 Code: System call arguments</h3><ul>
<li>System call implementations in the kernel need to find the arguments passed by user code. Because<br>user code calls system call wrapper functions, the arguments are initially where the RISC-V C<br>calling convention places them: in registers. The kernel trap code saves user registers to the current<br>process’s trap frame, where kernel code can find them. The kernel functions argint, argaddr,<br>and argfd retrieve the n ’th system call argument from the trap frame as an integer, pointer, or a file<br>descriptor. They all call argraw to retrieve the appropriate saved user register (kernel&#x2F;syscall.c:34).<br>Some system calls pass pointers as arguments, and the kernel must use those pointers to read<br>or write user memory. The exec system call, for example, passes the kernel an array of pointers<br>referring to string arguments in user space. These pointers pose two challenges. First, the user pro-<br>gram may be buggy or malicious, and may pass the kernel an invalid pointer or a pointer intended<br>to trick the kernel into accessing kernel memory instead of user memory. Second, the xv6 kernel<br>page table mappings are not the same as the user page table mappings, so the kernel cannot use<br>ordinary instructions to load or store from user-supplied addresses.<br>The kernel implements functions that safely transfer data to and from user-supplied addresses.<br>fetchstr is an example (kernel&#x2F;syscall.c:25). File system calls such as exec use fetchstr to<br>retrieve string file-name arguments from user space. fetchstr calls copyinstr to do the hard<br>work.<br>copyinstr (kernel&#x2F;vm.c:415) copies up to max bytes to dst from virtual address srcva in<br>the user page table pagetable. Since pagetable is not the current page table, copyinstr<br>uses walkaddr (which calls walk) to look up srcva in pagetable, yielding physical address<br>pa0. The kernel’s page table maps all of physical RAM at virtual addresses that are equal to the<br>RAM’s physical address. This allows copyinstr to directly copy string bytes from pa0 to dst.<br>walkaddr (kernel&#x2F;vm.c:109) checks that the user-supplied virtual address is part of the process’s user address space, so programs cannot trick the kernel into reading other memory. A similar<br>function, copyout, copies data from the kernel to a user-supplied address.</li>
</ul>
<h3 id="4-5-Traps-from-kernel-space"><a href="#4-5-Traps-from-kernel-space" class="headerlink" title="4.5 Traps from kernel space"></a>4.5 Traps from kernel space</h3><p>Xv6 handles traps from kernel code in a different way than traps from user code. When entering<br>the kernel, usertrap points stvec to the assembly code at kernelvec (kernel&#x2F;kernelvec.S:12).<br>Since kernelvec only executes if xv6 was already in the kernel, kernelvec can rely on<br>satp being set to the kernel page table, and on the stack pointer referring to a valid kernel stack.<br>kernelvec pushes all 32 registers onto the stack, from which it will later restore them so that<br>the interrupted kernel code can resume without disturbance.<br>kernelvec saves the registers on the stack of the interrupted kernel thread, which makes<br>sense because the register values belong to that thread. This is particularly important if the trap<br>causes a switch to a different thread – in that case the trap will actually return from the stack of the<br>new thread, leaving the interrupted thread’s saved registers safely on its stack.<br>kernelvec jumps to kerneltrap (kernel&#x2F;trap.c:135) after saving registers. kerneltrap<br>is prepared for two types of traps: device interrupts and exceptions. It calls devintr (kernel&#x2F;-<br>trap.c:185) to check for and handle the former. If the trap isn’t a device interrupt, it must be an<br>exception, and that is always a fatal error if it occurs in the xv6 kernel; the kernel calls panic and<br>stops executing.<br>If kerneltrap was called due to a timer interrupt, and a process’s kernel thread is running<br>(as opposed to a scheduler thread), kerneltrap calls yield to give other threads a chance to<br>run. At some point one of those threads will yield, and let our thread and its kerneltrap resume<br>again. Chapter 7 explains what happens in yield.<br>When kerneltrap’s work is done, it needs to return to whatever code was interrupted<br>by the trap. Because a yield may have disturbed sepc and the previous mode in sstatus,<br>kerneltrap saves them when it starts. It now restores those control registers and returns to<br>kernelvec (kernel&#x2F;kernelvec.S:38). kernelvec pops the saved registers from the stack and ex-<br>ecutes sret, which copies sepc to pc and resumes the interrupted kernel code.<br>It’s worth thinking through how the trap return happens if kerneltrap called yield due to<br>a timer interrupt.<br>Xv6 sets a CPU’s stvec to kernelvec when that CPU enters the kernel from user space;<br>you can see this in usertrap (kernel&#x2F;trap.c:29). There’s a window of time when the kernel has<br>started executing but stvec is still set to uservec, and it’s crucial that no device interrupt occur<br>during that window. Luckily the RISC-V always disables interrupts when</p>
<h3 id="4-6-Page-fault-exceptions"><a href="#4-6-Page-fault-exceptions" class="headerlink" title="4.6 Page-fault exceptions"></a>4.6 Page-fault exceptions</h3><h3 id="4-7-Real-world"><a href="#4-7-Real-world" class="headerlink" title="4.7 Real world"></a>4.7 Real world</h3><h3 id="4-8-Exercises"><a href="#4-8-Exercises" class="headerlink" title="4.8 Exercises"></a>4.8 Exercises</h3></div><div class="article-licensing box"><div class="licensing-title"><p>xv6-riscv_ch4</p><p><a href="https://goko-son626.github.io/post/xv6-riscv-ch4.html">https://goko-son626.github.io/post/xv6-riscv-ch4.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="https://GoKo-Son626.github.io"><p>GoKo Mell</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-02-12</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-05-16</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 相关文章</span><br><span>  1.<a class="is-size-6" href="/post/qspinlock.html" target="_blank">qspinlock</a><br></span><span>  2.<a class="is-size-6" href="/post/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA.html" target="_blank">hexo博客搭建</a><br></span><span>  3.<a class="is-size-6" href="/post/xv6-riscv-ch3.html" target="_blank">xv6-riscv_ch3</a><br></span><span>  4.<a class="is-size-6" href="/post/xv6-riscv-ch2.html" target="_blank">xv6-riscv-ch2</a><br></span><span>  5.<a class="is-size-6" href="/post/xv6-riscv-ch1.html" target="_blank">xv6-riscv-ch1</a><br></span><span>  6.<a class="is-size-6" href="/post/xv6-riscv-struct.html" target="_blank">xv6-riscv_struct</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/zfb.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/vx.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/post/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">hexo博客搭建</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/post/xv6-riscv-ch3.html"><span class="level-item">xv6-riscv_ch3</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: 'c9eb2fed64c7d1c21a0535ad12c23262',
            repo: 'blog_comment',
            owner: 'GoKo-Son626',
            clientID: 'Ov23liQkUSIVMH77fBvF',
            clientSecret: '7944864208d7577569d1f323e727967d4bdc5e79',
            admin: ["Goko-Son626"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/logo.png" alt="GoKo Mell"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">GoKo Mell</p><p class="is-size-6 is-block">尚未执佩剑，转眼即江湖</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/GoKo-Son626" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/GoKo-Son626"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:goku.sonxin626@gmail.com"><i class="fa fa-envelope"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-05-03T01:25:24.000Z">2025-05-03</time></p><p class="title"><a href="/post/qspinlock.html">qspinlock</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-05-01T05:25:09.000Z">2025-05-01</time></p><p class="title"><a href="/post/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA.html">hexo博客搭建</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-12T13:59:10.000Z">2025-02-12</time></p><p class="title"><a href="/post/xv6-riscv-ch4.html">xv6-riscv_ch4</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-10T01:25:24.000Z">2025-02-10</time></p><p class="title"><a href="/post/xv6-riscv-ch3.html">xv6-riscv_ch3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-05T04:27:56.000Z">2025-02-05</time></p><p class="title"><a href="/post/xv6-riscv-ch2.html">xv6-riscv-ch2</a></p></div></article></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2025/05/"><span class="level-start"><span class="level-item">五月 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/xv6-riscv/"><span class="tag">xv6-riscv</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/riscv/"><span class="tag">riscv</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/GoKo-Mell.png" alt="GoKo&#039;s blog" height="28"></a><p class="size-small"><span>&copy; 2025 GoKo Mell</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="mailto:goku.sonxin626@gmail.com">联系我</a>，立即处理]<br /></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23liQkUSIVMH77fBvF','7944864208d7577569d1f323e727967d4bdc5e79','GoKo-Son626','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>